# CSRF란?

CSRF(Cross-Site Request Forgery, 사이트 간 요청 위조)는 사용자가 이미 인증된 상태(세션 쿠키 보유)에서, 공격자가 사용자를 속여 사용자의 권한으로 원치 않는 요청을 서버에 전송하게 만드는
공격이다.

---

## 동작 방식 (흐름)

1. 사용자가 A 사이트에 로그인하여 세션 쿠키를 획득한다.
2. 사용자가 공격자가 만든 사이트(B)에 접속한다.
3. B 사이트에서 A 사이트로 자동 요청(자동 폼 전송, 이미지/스크립트 요청 등)을 발생시킨다.
4. 브라우저는 동일 도메인 정책에 따라 A 사이트의 세션 쿠키를 자동으로 첨부한다.
5. 서버는 해당 요청을 정상 사용자의 요청으로 인식하여 민감한 작업을 수행할 수 있다.

---

## REST 방식에서 CSRF가 필요 없는(혹은 낮은) 이유

- REST API는 일반적으로 상태를 서버에 저장하지 않는(Stateless) 구조이다.
- 쿠키 대신 Authorization 헤더의 Bearer 토큰(JWT 등)을 사용하여 인증 정보를 전송한다.
- 브라우저는 자바스크립트로 명시적으로 헤더를 설정하지 않는 한 토큰을 자동으로 첨부하지 않는다.
- 따라서 공격자가 사용자의 인증 토큰을 직접 획득하지 않는 이상 CSRF 공격이 성립하기 어렵다.
- 단, REST API라도 쿠키 기반 인증을 사용하면 CSRF 방어가 필요하다.

---

## 세션 기반 인증에서 CSRF가 필요한 이유 및 방어 방법

- 문제 원인: 브라우저가 동일 도메인 요청에 세션 쿠키를 자동으로 첨부하므로, 외부 사이트에서 유도한 요청도 인증된 요청으로 처리될 수 있다.
- 대표적 방어 방법:
    1. CSRF 토큰: 서버가 세션별 난수를 발급하고, 클라이언트는 요청 시 토큰을 함께 전송한다. 서버는 세션의 토큰과 비교하여 검증한다.
    2. SameSite 쿠키 속성: `SameSite=Strict|Lax`로 설정하여 타사이트 요청 시 쿠키 전송을 제한한다.
    3. CORS 및 Referer/Origin 검증: 출처 확인으로 의심스러운 요청 차단.
    4. 토큰 기반 인증(헤더 전송)으로 전환: 브라우저가 자동으로 첨부하지 않는 방식 사용.

---

## 요약

- CSRF는 세션 쿠키의 자동 전송을 악용한 공격이다.
- REST(토큰 기반, 명시적 인증) 구조에서는 CSRF 위험이 낮다.
- 세션 기반(쿠키) 인증에서는 CSRF 토큰 등 별도의 방어가 필요하다.